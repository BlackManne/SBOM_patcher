{"detail": {"message": "fix crsf_rc: prevent potential buffer overflow for unknown packets\n\nThe length check for unknown packets did not include PACKET_SIZE_TYPE_SIZE\nand CRC_SIZE, and hence working_index could overflow CRSF_MAX_PACKET_LEN,\ntriggering invalid memory access further down in QueueBuffer_PeekBuffer.\n\nAlso the working_segment_size was wrong for unknown packets.\n\nCredits for finding this go to @Pwn9uin.", "changes": {"total": 4, "additions": 2, "deletions": 2}, "files": [{"filename": "src/drivers/rc/crsf_rc/CrsfParser.cpp", "additions": 2, "deletions": 2, "blob_url": "https://github.com/PX4/PX4-Autopilot/blob/d1fcd39a44e6312582c6ab02b0d5ee2599fb55aa/src%2Fdrivers%2Frc%2Fcrsf_rc%2FCrsfParser.cpp", "diff": "@@ -293,9 +293,9 @@ bool CrsfParser_TryParseCrsfPacket(CrsfPacket_t *const new_packet, CrsfParserSta\n \t\t\t} else {\n \t\t\t\t// We don't know what this packet is, so we'll let the parser continue\n \t\t\t\t// just so that we can dequeue it in one shot\n-\t\t\t\tworking_segment_size = packet_size + PACKET_SIZE_TYPE_SIZE;\n+\t\t\t\tworking_segment_size = packet_size - PACKET_SIZE_TYPE_SIZE;\n \n-\t\t\t\tif (working_segment_size > CRSF_MAX_PACKET_LEN) {\n+\t\t\t\tif (working_index + working_segment_size + CRC_SIZE > CRSF_MAX_PACKET_LEN) {\n \t\t\t\t\tparser_statistics->invalid_unknown_packet_sizes++;\n \t\t\t\t\tparser_state = PARSER_STATE_HEADER;\n \t\t\t\t\tworking_segment_size = HEADER_SIZE;"}]}, "source": "github", "service_name": "github_commit"}